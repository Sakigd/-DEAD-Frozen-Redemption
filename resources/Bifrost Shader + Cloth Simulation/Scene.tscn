[gd_scene load_steps=14 format=3 uid="uid://bbyfcgyong2sp"]

[ext_resource type="Shader" path="res://ColorQuantizer.gdshader" id="1_fc7if"]
[ext_resource type="Texture2D" uid="uid://cvetkbwfhy8jq" path="res://Igris.png" id="1_t1m4f"]
[ext_resource type="Texture2D" uid="uid://mb07lvlabq0u" path="res://QuantizerDefaultNoise.tres" id="2_kt3v7"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_pc60t"]
shader = ExtResource("1_fc7if")
shader_parameter/opacity = 0.6
shader_parameter/tint_brightness = 1.3
shader_parameter/base_brightness = 0.9
shader_parameter/specular_color = Vector4(0.4, 0.7, 0.9, 1.2)
shader_parameter/specular_contrast = 5.0
shader_parameter/specular_spread = 1.0
shader_parameter/specular_map = ExtResource("2_kt3v7")

[sub_resource type="GDScript" id="GDScript_b57h3"]
script/source = "extends Camera2D
const speed = 300

func _process(delta):
	var move = Vector2.ZERO 
	if Input.is_key_label_pressed(KEY_LEFT) :
		move.x -= speed*delta
	if Input.is_key_label_pressed(KEY_RIGHT) :
		move.x += speed*delta
	if Input.is_key_label_pressed(KEY_UP) :
		move.y -= speed*delta
	if Input.is_key_label_pressed(KEY_DOWN) :
		move.y += speed*delta
	position += move
	if not Input.is_key_label_pressed(KEY_SPACE) :
		get_node(\"../Marker2D\").global_position = get_global_mouse_position()
	
	if Input.is_key_label_pressed(KEY_ESCAPE) :
		get_tree().root.queue_free()
"

[sub_resource type="Curve" id="Curve_yvh1l"]
_data = [Vector2(0.373626, 1), 0.0, 0.0, 0, 0]
point_count = 1

[sub_resource type="CurveXYZTexture" id="CurveXYZTexture_bn682"]
width = 1365
curve_x = SubResource("Curve_yvh1l")
curve_y = SubResource("Curve_yvh1l")
curve_z = SubResource("Curve_yvh1l")

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_j4eab"]
blend_mode = 3

[sub_resource type="Curve" id="Curve_k0b5e"]
_data = [Vector2(0, 0.78022), 3.18302, 1.31868, 0, 0, Vector2(0.836842, 0.736264), -1.78087, -1.78087, 0, 0, Vector2(0.9875, 0.021978), -3.43656, 0.0, 0, 0]
point_count = 3

[sub_resource type="Gradient" id="Gradient_003cn"]
offsets = PackedFloat32Array(0.035, 0.99)
colors = PackedColorArray(0.09, 0.0126, 0.0126, 1, 0.61971, 0.91, 0.3822, 1)

[sub_resource type="GDScript" id="GDScript_x81ac"]
script/source = "@tool
extends Line2D
@export_category(\"Position\")
@export var target : Node2D
@export var offset : Vector2
@export_category(\"Setup\")
@export var segments = 7
@export var segment_length = 16
@export var min_angle = 90
@export_category(\"Physics\")
@export var inertia = 0.5
@export var dampening = 0.5
@export var transfer = 0.75
@export_category(\"Oscillation\")
@export var natural_direction = 0.0
@export var resistance = 1.0
@export_range(-1,1) var oscillation_strength = 0.5
@export var oscillation_speed = 4.0
var velocities = []
@export var record_position = true

func _ready():
	velocities = []
	for x in range(segments) : 
		velocities.append(Vector2.ZERO)

var time = 0.0
func _process(delta):
	if record_position == false and Engine.is_editor_hint() :
		return
	
	time += delta * oscillation_speed
	
	if not points.size() == segments :
		points = []
		velocities = []
		for x in range(segments) : 
			add_point(Vector2.ZERO)
			velocities.append(Vector2.ZERO)
	
	for point in range(points.size()) :
		if point == 0 :
			set_point_position(0,to_local(target.global_position+offset))
			continue
		
		var verylast = null
		if point >= 2 :
			verylast = points[point-2]
		var last = points[point-1]
		var current = points[point]
		var angle = null
		
		#velocities[point] += Vector2.from_angle(last.direction_to(current).angle()-deg_to_rad(90))*sin(point/2)*sin(wind/10)*0.1
		if point != points.size()-1 :
			current += velocities[point]*inertia#*(1-(point+1)/points.size())
			current += velocities[point+1]*inertia*0.5
		
		if last.distance_to(current) != segment_length :
			
			var newpos : Vector2
			if current != last :
				newpos = last.direction_to(current) * segment_length
				velocities[point] += (current.direction_to(last+newpos) * current.distance_to(last+newpos)) * (((point+1)/points.size())*transfer+1-transfer)
			else :
				newpos = Vector2(1,0).normalized() * segment_length
			
			current = last+newpos
			
			if verylast :
				var LV = verylast - last
				var LC = current - last
				angle = rad_to_deg(acos(  (LV.dot(LC)) / (LV.length() * LC.length())  ))
			 
			if angle and angle < min_angle :
				print(\"close at point \",point)
		
		if last :
			velocities[point] = velocities[point].normalized() * velocities[point].length()*dampening
		var natural_direction_vec = Vector2.from_angle(deg_to_rad(natural_direction-90))
		if point == 1 :
			velocities[point] += Vector2.from_angle(natural_direction_vec.angle()+sin(time)*deg_to_rad(oscillation_strength*180)) * natural_direction_vec.length()
		velocities[point] += natural_direction_vec.normalized() * resistance
		
		set_point_position(point,current)
"

[sub_resource type="Gradient" id="Gradient_i4mmp"]
offsets = PackedFloat32Array(0.035, 0.99)
colors = PackedColorArray(0.0126, 0.05517, 0.09, 1, 0.479733, 0.56, 0.0784, 1)

[sub_resource type="Gradient" id="Gradient_n7wf8"]
offsets = PackedFloat32Array(0.035, 0.99)
colors = PackedColorArray(0.0126, 0.09, 0.03066, 1, 0.13395, 0.45, 0.063, 1)

[node name="Scene" type="Node2D"]

[node name="Igris" type="Sprite2D" parent="."]
texture_filter = 1
material = SubResource("ShaderMaterial_pc60t")
position = Vector2(-536, -295)
texture = ExtResource("1_t1m4f")

[node name="Camera" type="Camera2D" parent="."]
script = SubResource("GDScript_b57h3")

[node name="Marker2D" type="Marker2D" parent="."]
position = Vector2(-30, -1)

[node name="Sprite2D" type="Sprite2D" parent="Marker2D"]
position = Vector2(-2, -12.5)
scale = Vector2(1, 1365)
texture = SubResource("CurveXYZTexture_bn682")

[node name="Line2D2" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, -3, -30.6259, -10.9755, -33.7315, -3.60288, -36.9788, 3.70844, -40.2272, 11.0192, -43.4893, 18.3239, -46.5133, 25.7304, -48.6822, 33.4308, -49.2529, 41.4104, -47.8731, 49.2905, -45.007, 56.7595, -41.669, 64.0298, -38.935, 71.5481, -37.7758, 79.4637, -38.8728, 87.3881, -42.2415, 94.6443, -47.1569, 100.956, -52.6469, 106.775, -57.8238, 112.874, -61.7698, 119.833, -63.4468, 127.656, -62.0669, 135.536, -57.8641, 142.343, -52.0327, 147.819, -45.7085, 152.719, -39.6806, 157.979, -34.7213, 164.256, -31.8384, 171.718, -32.2201, 179.709, -36.4744, 186.484, -43.4606, 190.382, -51.3332, 191.804, -59.3187, 192.285, -67.28, 193.072, -75.0394, 195.019, -82.1253, 198.732, -87.639, 204.529, -90.2382, 212.095, -88.7211, 219.95, -83.4875, 226, -76.4017, 229.714, -68.7605, 232.083, -61.0242, 234.12, -53.3749, 236.463, -45.9735, 239.499, -39.0182, 243.452, -32.7093, 248.371, -28.9632, 255.439, -23.6137, 261.388, -26.3755, 268.896)
width = 16.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_003cn")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, -2)
segments = 50
segment_length = 8
min_angle = 0
inertia = 0.35
dampening = 0.9
natural_direction = 190.0
resistance = 0.4
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D3" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
position = Vector2(-172, 204)
points = PackedVector2Array(142, -205, 141.361, -212.974, 140.593, -205.011, 139.074, -197.157, 137.434, -189.327, 136.177, -181.426, 135.353, -173.469, 134.355, -165.531, 132.282, -157.805, 128.723, -150.64, 124.242, -144.012, 120, -137.23, 117.4, -129.664, 118.035, -121.689, 122.767, -115.238, 130.008, -111.838, 137.772, -109.909, 145.296, -107.191, 151.625, -102.298, 155.398, -95.2435, 156.804, -87.3681, 158.005, -79.4587, 160.724, -71.9352, 165.14, -65.2645, 170.374, -59.2142, 175.491, -53.0642, 179.698, -46.2602, 182.209, -38.6642, 182.207, -30.6642, 179.071, -23.3048, 172.942, -18.1632, 165.15, -16.3479, 157.224, -17.4323, 149.717, -20.196, 142.519, -23.6874, 135.409, -27.3548, 128.227, -30.8794, 120.885, -34.0551, 113.344, -36.7278, 105.608, -38.7657, 97.711, -40.0442, 89.7206, -40.4375, 81.7449, -39.8146, 73.9471, -38.0274, 66.5529, -34.9737, 60.0723, -30.2831, 54.6756, -24.3775, 52.1189, -16.797, 48.6837, -9.57212, 52.7224, -2.66645)
width = 16.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_i4mmp")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
segments = 50
segment_length = 8
min_angle = 0
inertia = 0.55
dampening = 0.9
natural_direction = 180.0
resistance = 0.4
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, 1, -32.5039, -6.59805, -32.3981, 1.40125, -32.6962, 9.3957, -32.9094, 17.3929, -33.0941, 25.3907, -33.6471, 33.3716, -34.7858, 41.2901, -36.1208, 49.178, -36.7103, 57.1562, -35.46, 65.0579, -31.7278, 72.1339, -25.9297, 77.6459, -19.128, 81.8574, -12.1264, 85.7275, -5.41467, 90.081, 0.601295, 95.3544, 5.51283, 101.669, 8.86757, 108.932, 10.1529, 116.828, 8.92902, 124.734, 5.17251, 131.797, -0.510383, 137.428, -7.24742, 141.742, -14.3887, 145.348, -21.5553, 148.903, -28.4744, 152.919, -34.8585, 157.74, -40.3483, 163.559, -44.4873, 170.405, -46.7161, 178.088, -46.4163, 186.083, -43.103, 193.364, -36.9123, 198.431, -29.0805, 200.063, -21.2428, 198.46, -14.1066, 194.844, -7.54305, 190.27, -1.23973, 185.344, 5.04194, 180.39, 11.4456, 175.595, 18.0474, 171.076, 24.8813, 166.917, 31.9548, 163.18, 39.2622, 159.924, 46.7494, 157.106, 54.4763, 155.033, 62.4636, 154.583, 67.2767, 148.193, 75.0356, 150.142)
width = 16.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_n7wf8")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, 2)
segments = 50
segment_length = 8
min_angle = 0
inertia = 0.45
dampening = 0.9
natural_direction = 170.0
resistance = 0.4
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D7" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, -3, -35.133, -9.13611, -37.3685, -1.45478, -39.4218, 6.27724, -41.3199, 14.0488, -43.1481, 21.8371, -44.9962, 29.6207, -46.8746, 37.3971, -48.6448, 45.1988, -50.0295, 53.078, -50.7186, 61.0483, -50.5323, 69.0461, -49.5522, 76.9858, -48.115, 84.8557, -46.6767, 92.7253, -45.6634, 100.661, -45.3696, 108.655, -45.9172, 116.637, -47.2764, 124.52, -49.3262, 132.253, -51.9038, 139.827, -54.8134, 147.279, -57.809, 154.697, -60.5787, 162.202, -62.7517, 169.901, -63.9449, 177.812, -63.8632, 185.811, -62.4313, 193.682, -59.8628, 201.259, -56.5921, 208.56, -53.1422, 215.777, -50.0503, 223.156, -47.859, 230.85, -47.1028, 238.814, -48.2158, 246.736, -51.3648, 254.09, -56.3421, 260.353, -62.2697, 265.726, -69.3173, 269.512, -77.2661, 270.415)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_003cn")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, -2)
segments = 40
segment_length = 8
min_angle = 0
inertia = 0.3
dampening = 0.9
natural_direction = 190.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D8" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
position = Vector2(-172, 204)
points = PackedVector2Array(142, -205, 138.808, -212.336, 137.808, -204.398, 136.73, -196.471, 135.698, -188.538, 134.736, -180.596, 133.906, -172.639, 133.376, -164.657, 133.345, -156.657, 133.817, -148.671, 134.425, -140.694, 134.485, -132.694, 133.284, -124.785, 130.518, -117.278, 126.553, -110.33, 122.187, -103.626, 118.322, -96.622, 115.932, -88.9873, 116.076, -80.9886, 119.5, -73.7581, 125.748, -68.7619, 133.33, -66.2102, 141.233, -64.967, 149.147, -63.8019, 156.892, -61.7962, 164.068, -58.2598, 169.838, -52.7187, 172.692, -45.2451, 170.801, -37.4719, 164.624, -32.3876, 156.994, -29.9835, 149.189, -28.2284, 141.58, -25.7586, 134.636, -21.7854, 129.232, -15.8864, 126.644, -8.31651, 128.957, -0.657927, 134.558, 5.05348, 142.556, 4.86479, 150.549, 5.19901)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_i4mmp")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
segments = 40
segment_length = 8
min_angle = 0
dampening = 0.9
natural_direction = 180.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D9" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, 1, -35.5947, -4.71838, -35.2642, 3.27479, -34.8575, 11.2645, -34.2799, 19.2436, -33.48, 27.2035, -32.4574, 35.1378, -31.3251, 43.0573, -30.3298, 50.9952, -29.7517, 58.9743, -29.7042, 66.9741, -29.9611, 74.97, -29.9561, 82.97, -28.9579, 90.9075, -26.3554, 98.4723, -22.0172, 105.194, -16.4277, 110.917, -10.3412, 116.109, -4.46941, 121.543, 0.494355, 127.816, 3.92907, 135.042, 5.68054, 142.847, 6.33793, 150.82, 6.86015, 158.803, 7.97682, 166.725, 9.81172, 174.512, 11.8577, 182.246, 13.2532, 190.123, 13.1013, 198.122, 10.844, 205.797, 6.63868, 212.602, 1.21494, 218.483, -4.66051, 223.912, -10.3962, 229.489, -15.447, 235.693, -19.2281, 242.743, -21.0026, 250.544, -18.7183, 258.211, -19.2162, 266.195, -11.5044, 264.067)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_n7wf8")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, 2)
segments = 40
segment_length = 8
min_angle = 0
inertia = 0.4
dampening = 0.9
natural_direction = 170.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D4" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, -3, -33.3629, -10.2588, -34.4768, -2.33676, -35.6352, 5.57894, -36.6601, 13.513, -37.4958, 21.4692, -38.0655, 29.4489, -38.2927, 37.4457, -38.2542, 45.4456, -38.2521, 53.4456, -38.6375, 61.4363, -39.4827, 69.3915, -40.3894, 77.34, -40.6254, 85.3365, -39.4842, 93.2547, -36.6747, 100.745, -32.5715, 107.613, -27.9595, 114.15, -24.4772, 121.352, -20.1544, 128.083)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_003cn")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, -2)
segments = 20
segment_length = 8
min_angle = 0
inertia = 0.6
dampening = 0.8
transfer = 0.6
natural_direction = 180.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D5" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
position = Vector2(-166, 208)
points = PackedVector2Array(136, -209, 133.949, -216.732, 131.476, -209.124, 128.961, -201.53, 126.574, -193.894, 124.369, -186.204, 122.422, -178.445, 120.81, -170.609, 119.459, -162.724, 118.072, -154.845, 116.305, -147.042, 114.091, -139.355, 111.817, -131.685, 110.197, -123.851, 109.948, -115.854, 111.405, -107.988, 114.243, -100.509, 117.624, -93.2583, 120.562, -85.8173, 122.121, -77.9705, 121.628, -69.9857, 119.062, -62.4086, 115.185, -55.4109, 111.107, -48.5281, 107.856, -41.2184, 106.178, -33.3963, 105.757, -25.4074, 106.347, -17.4292, 106.143, -9.43184, 102.777, -2.17443)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_i4mmp")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
segments = 30
segment_length = 8
min_angle = 0
inertia = 0.6
dampening = 0.8
transfer = 0.6
natural_direction = 190.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D6" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, 1, -35.6428, -4.67087, -33.98, 3.15441, -32.3612, 10.9889, -30.6107, 18.795, -28.6748, 26.5573, -26.4809, 34.2506, -23.9594, 41.8428, -21.1871, 49.3471, -18.4489, 56.8639, -16.078, 64.5045, -14.1514, 72.2691, -12.2851, 80.0483, -9.7717, 87.6432, -5.98917, 94.6925, -0.79385, 100.776, 5.40378, 105.835, 11.957, 110.423, 18.2217, 115.398, 23.4976, 121.412, 27.057, 128.577, 28.5874, 136.429, 29.0627, 144.415, 29.0513, 152.415, 35.1616, 157.579)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_n7wf8")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, 2)
segments = 25
segment_length = 8
min_angle = 0
inertia = 0.6
dampening = 0.8
transfer = 0.6
natural_direction = 160.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0
