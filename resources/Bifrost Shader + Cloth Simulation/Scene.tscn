[gd_scene load_steps=14 format=3 uid="uid://bbyfcgyong2sp"]

[ext_resource type="Shader" path="res://ColorQuantizer.gdshader" id="1_fc7if"]
[ext_resource type="Texture2D" uid="uid://cvetkbwfhy8jq" path="res://Igris.png" id="1_t1m4f"]
[ext_resource type="Texture2D" uid="uid://mb07lvlabq0u" path="res://QuantizerDefaultNoise.tres" id="2_kt3v7"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_pc60t"]
shader = ExtResource("1_fc7if")
shader_parameter/opacity = 0.6
shader_parameter/tint_brightness = 1.3
shader_parameter/base_brightness = 0.9
shader_parameter/specular_color = Vector4(0.4, 0.7, 0.9, 1.2)
shader_parameter/specular_contrast = 5.0
shader_parameter/specular_spread = 1.0
shader_parameter/specular_map = ExtResource("2_kt3v7")

[sub_resource type="GDScript" id="GDScript_b57h3"]
script/source = "extends Camera2D
const speed = 300

func _process(delta):
	var move = Vector2.ZERO 
	if Input.is_key_label_pressed(KEY_LEFT) :
		move.x -= speed*delta
	if Input.is_key_label_pressed(KEY_RIGHT) :
		move.x += speed*delta
	if Input.is_key_label_pressed(KEY_UP) :
		move.y -= speed*delta
	if Input.is_key_label_pressed(KEY_DOWN) :
		move.y += speed*delta
	position += move
	if not Input.is_key_label_pressed(KEY_SPACE) :
		get_node(\"../Marker2D\").global_position = get_global_mouse_position()
	
	if Input.is_key_label_pressed(KEY_ESCAPE) :
		get_tree().root.queue_free()
"

[sub_resource type="Curve" id="Curve_yvh1l"]
_data = [Vector2(0.373626, 1), 0.0, 0.0, 0, 0]
point_count = 1

[sub_resource type="CurveXYZTexture" id="CurveXYZTexture_bn682"]
width = 1365
curve_x = SubResource("Curve_yvh1l")
curve_y = SubResource("Curve_yvh1l")
curve_z = SubResource("Curve_yvh1l")

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_j4eab"]
blend_mode = 3

[sub_resource type="Curve" id="Curve_k0b5e"]
_data = [Vector2(0, 0.78022), 3.18302, 1.31868, 0, 0, Vector2(0.836842, 0.736264), -1.78087, -1.78087, 0, 0, Vector2(0.9875, 0.021978), -3.43656, 0.0, 0, 0]
point_count = 3

[sub_resource type="Gradient" id="Gradient_003cn"]
offsets = PackedFloat32Array(0.035, 0.99)
colors = PackedColorArray(0.09, 0.0126, 0.0126, 1, 0.61971, 0.91, 0.3822, 1)

[sub_resource type="GDScript" id="GDScript_x81ac"]
script/source = "@tool
extends Line2D
@export_category(\"Position\")
@export var target : Node2D
@export var offset : Vector2
@export_category(\"Setup\")
@export var segments = 7
@export var segment_length = 16
@export var min_angle = 90
@export_category(\"Physics\")
@export var inertia = 0.5
@export var dampening = 0.5
@export var transfer = 0.75
@export_category(\"Oscillation\")
@export var natural_direction = 0.0
@export var resistance = 1.0
@export_range(-1,1) var oscillation_strength = 0.5
@export var oscillation_speed = 4.0
var velocities = []
@export var record_position = true

func _ready():
	velocities = []
	for x in range(segments) : 
		velocities.append(Vector2.ZERO)

var time = 0.0
func _process(delta):
	if record_position == false and Engine.is_editor_hint() :
		return
	
	time += delta * oscillation_speed
	
	if not points.size() == segments :
		points = []
		velocities = []
		for x in range(segments) : 
			add_point(Vector2.ZERO)
			velocities.append(Vector2.ZERO)
	
	for point in range(points.size()) :
		if point == 0 :
			set_point_position(0,to_local(target.global_position+offset))
			continue
		
		var verylast = null
		if point >= 2 :
			verylast = points[point-2]
		var last = points[point-1]
		var current = points[point]
		var angle = null
		
		#velocities[point] += Vector2.from_angle(last.direction_to(current).angle()-deg_to_rad(90))*sin(point/2)*sin(wind/10)*0.1
		if point != points.size()-1 :
			current += velocities[point]*inertia#*(1-(point+1)/points.size())
			current += velocities[point+1]*inertia*0.5
		
		if last.distance_to(current) != segment_length :
			
			var newpos : Vector2
			if current != last :
				newpos = last.direction_to(current) * segment_length
				velocities[point] += (current.direction_to(last+newpos) * current.distance_to(last+newpos)) * (((point+1)/points.size())*transfer+1-transfer)
			else :
				newpos = Vector2(1,0).normalized() * segment_length
			
			current = last+newpos
			
			if verylast :
				var LV = verylast - last
				var LC = current - last
				angle = rad_to_deg(acos(  (LV.dot(LC)) / (LV.length() * LC.length())  ))
			 
			if angle and angle < min_angle :
				print(\"close at point \",point)
		
		if last :
			velocities[point] = velocities[point].normalized() * velocities[point].length()*dampening
		var natural_direction_vec = Vector2.from_angle(deg_to_rad(natural_direction-90))
		if point == 1 :
			velocities[point] += Vector2.from_angle(natural_direction_vec.angle()+sin(time)*deg_to_rad(oscillation_strength*180)) * natural_direction_vec.length()
		velocities[point] += natural_direction_vec.normalized() * resistance
		
		set_point_position(point,current)
"

[sub_resource type="Gradient" id="Gradient_i4mmp"]
offsets = PackedFloat32Array(0.035, 0.99)
colors = PackedColorArray(0.0126, 0.05517, 0.09, 1, 0.479733, 0.56, 0.0784, 1)

[sub_resource type="Gradient" id="Gradient_n7wf8"]
offsets = PackedFloat32Array(0.035, 0.99)
colors = PackedColorArray(0.0126, 0.09, 0.03066, 1, 0.13395, 0.45, 0.063, 1)

[node name="Scene" type="Node2D"]

[node name="Igris" type="Sprite2D" parent="."]
texture_filter = 1
material = SubResource("ShaderMaterial_pc60t")
position = Vector2(-536, -295)
texture = ExtResource("1_t1m4f")

[node name="Camera" type="Camera2D" parent="."]
script = SubResource("GDScript_b57h3")

[node name="Marker2D" type="Marker2D" parent="."]
position = Vector2(-30, -1)

[node name="Sprite2D" type="Sprite2D" parent="Marker2D"]
position = Vector2(-2, -12.5)
scale = Vector2(1, 1365)
texture = SubResource("CurveXYZTexture_bn682")

[node name="Line2D2" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, -3, -22.3222, -5.24745, -22.6906, 2.74407, -23.2618, 10.7236, -24.2105, 18.6672, -26.1, 26.4408, -29.3992, 33.7289, -33.943, 40.3133, -38.9869, 46.5228, -43.6358, 53.0334, -47.0334, 60.2761, -48.5582, 68.1294, -48.1761, 76.1203, -46.5079, 83.9444, -44.4898, 91.6857, -43.1011, 99.5642, -43.282, 107.562, -45.74, 115.175, -50.5086, 121.599, -56.8195, 126.515, -63.7395, 130.529, -70.5893, 134.662, -76.7099, 139.814, -81.1445, 146.472, -82.6291, 154.333, -80.3726, 162.008, -75.2079, 168.118, -68.78, 172.88, -62.1792, 177.4, -56.1139, 182.617, -51.3697, 189.058, -49.0062, 196.701, -50.1697, 204.616, -55.1047, 210.913, -62.3178, 214.372, -70.1905, 215.794, -78.1536, 216.562, -86.0784, 217.656, -93.8163, 219.687, -101.078, 223.044, -107.395, 227.953, -112.077, 234.439, -114.194, 242.154, -112.767, 250.026, -107.578, 256.115, -100.066, 258.865, -92.0659, 258.922, -84.1835, 257.555, -81.0118, 250.211, -73.0594, 249.34)
width = 16.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_003cn")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, -2)
segments = 50
segment_length = 8
min_angle = 0
inertia = 0.35
dampening = 0.9
natural_direction = 190.0
resistance = 0.4
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D3" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
position = Vector2(-172, 204)
points = PackedVector2Array(142, -205, 148.076, -210.204, 149.325, -202.303, 150.148, -194.345, 150.74, -186.367, 151.627, -178.416, 153.227, -170.578, 155.277, -162.845, 156.765, -154.985, 156.329, -146.997, 152.957, -139.742, 147.097, -134.296, 140.278, -130.112, 133.697, -125.564, 128.524, -119.461, 126.13, -111.828, 126.547, -103.839, 127.747, -95.9292, 127.8, -87.9294, 126.282, -80.0748, 124.269, -72.3322, 123.267, -64.3951, 124.608, -56.5084, 129, -49.8216, 135.84, -45.6719, 143.686, -44.1124, 151.686, -44.0706, 159.674, -44.5157, 167.669, -44.7844, 175.663, -44.466, 183.576, -43.2898, 191.261, -41.0677, 198.505, -37.672, 205.023, -33.034, 210.452, -27.1585, 214.33, -20.1609, 216.065, -12.3514, 214.926, -4.43284, 210.202, 2.02337, 202.419, 3.87442, 196.02, -0.92616, 192.987, -8.32906, 191.069, -16.0958, 189.252, -23.8866, 186.966, -31.5531, 184.39, -39.127, 181.476, -46.5773, 174.111, -49.7021, 181.495, -52.7819, 174.935, -57.3614)
width = 16.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_i4mmp")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
segments = 50
segment_length = 8
min_angle = 0
inertia = 0.55
dampening = 0.9
natural_direction = 180.0
resistance = 0.4
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, 1, -24.291, -4.60419, -21.8069, 3.00037, -19.5527, 10.6762, -17.2056, 18.3242, -14.7342, 25.9329, -12.6697, 33.6619, -11.9211, 41.6268, -13.2081, 49.5226, -16.3577, 56.8765, -20.3641, 63.801, -24.1232, 70.8628, -26.7585, 78.4163, -27.7158, 86.3588, -26.8326, 94.3099, -24.2101, 101.868, -20.0165, 108.681, -14.4851, 114.46, -8.00058, 119.145, -1.02863, 123.069, 6.0156, 126.861, 12.7373, 131.199, 18.6243, 136.616, 22.9357, 143.354, 24.6989, 151.158, 23.0093, 158.977, 17.8643, 165.103, 10.6198, 168.497, 2.71135, 169.704, -5.28781, 169.82, -13.2861, 169.656, -21.286, 169.7, -29.2677, 170.242, -37.1743, 171.46, -44.9176, 173.471, -52.383, 176.346, -59.4327, 180.128, -65.9056, 184.829, -71.6144, 190.433, -76.3414, 196.888, -79.8329, 204.085, -81.7955, 211.841, -81.9024, 219.84, -79.8477, 227.572, -75.4408, 234.249, -68.9149, 238.876, -61.0582, 240.383, -53.14, 239.242, -58.4624, 245.214, -52.8844, 239.48)
width = 16.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_n7wf8")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, 2)
segments = 50
segment_length = 8
min_angle = 0
inertia = 0.45
dampening = 0.9
natural_direction = 170.0
resistance = 0.4
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D7" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, -3, -22.1918, -1.25869, -23.5241, 6.6296, -24.9153, 14.5077, -26.3433, 22.3792, -27.8913, 30.228, -29.7751, 38.0031, -32.2401, 45.6138, -35.3817, 52.9712, -39.0382, 60.0866, -42.8472, 67.1217, -46.3901, 74.2944, -49.3268, 81.7359, -51.4929, 89.4371, -52.9266, 97.3075, -53.8011, 105.26, -54.3235, 113.243, -54.6799, 121.235, -55.0488, 129.226, -55.6421, 137.204, -56.7215, 145.131, -58.5591, 152.917, -61.345, 160.416, -65.0875, 167.487, -69.5829, 174.104, -74.4796, 180.431, -79.3628, 186.767, -83.7897, 193.431, -87.2917, 200.624, -89.411, 208.338, -89.817, 216.328, -88.4617, 224.212, -85.6388, 231.697, -81.8647, 238.751, -77.7167, 245.592, -73.7196, 252.522, -70.4902, 259.841, -68.7161, 267.642, -67.487, 275.547, -73.5143, 280.807)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_003cn")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, -2)
segments = 40
segment_length = 8
min_angle = 0
inertia = 0.3
dampening = 0.9
natural_direction = 190.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D8" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
position = Vector2(-172, 204)
points = PackedVector2Array(142, -205, 149.773, -206.893, 150.138, -198.901, 150.411, -190.906, 150.531, -182.907, 150.424, -174.907, 150.17, -166.911, 150.09, -158.912, 150.612, -150.929, 151.942, -143.04, 153.8, -135.259, 155.458, -127.432, 155.979, -119.449, 154.499, -111.588, 150.675, -104.56, 145.024, -98.8976, 138.481, -94.295, 131.808, -89.8825, 125.644, -84.7821, 120.824, -78.3974, 118.572, -70.721, 120.134, -62.8749, 125.253, -56.7271, 132.025, -52.4681, 139.054, -48.6489, 145.52, -43.9385, 150.387, -37.589, 152.108, -29.7763, 149.456, -22.2287, 143.482, -16.9079, 136.297, -13.39, 128.923, -10.2869, 121.805, -6.63549, 115.356, -1.90152, 110.187, 4.20396, 106.949, 11.5196, 106.808, 19.5183, 110.614, 26.5554, 102.615, 26.4251, 110.238, 23.9985)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_i4mmp")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
segments = 40
segment_length = 8
min_angle = 0
dampening = 0.9
natural_direction = 180.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D9" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, 1, -22.3282, -1.268, -20.7196, 6.5686, -19.2338, 14.4294, -17.829, 22.3051, -16.3768, 30.1722, -14.7324, 38.0014, -12.9073, 45.7904, -11.1915, 53.6042, -10.1037, 61.5299, -10.1725, 69.5296, -11.6126, 77.3989, -14.1066, 85.0003, -16.9338, 92.484, -19.2543, 100.14, -20.3104, 108.07, -19.676, 116.045, -17.5361, 123.753, -14.6023, 131.196, -11.6929, 138.648, -9.37925, 146.306, -7.73685, 154.136, -6.27673, 162.002, -4.20869, 169.73, -0.880291, 177.004, 3.83601, 183.466, 9.50502, 189.111, 15.4776, 194.433, 21.1042, 200.12, 25.6465, 206.706, 28.1538, 214.303, 27.5946, 222.283, 23.5726, 229.199, 17.07, 233.859, 9.54826, 236.583, 1.77431, 238.472, -5.95803, 240.524, -12.9119, 244.479, -20.6304, 246.582, -25.6547, 252.808)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_n7wf8")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, 2)
segments = 40
segment_length = 8
min_angle = 0
inertia = 0.4
dampening = 0.9
natural_direction = 170.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D4" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, -3, -22.3998, -5.49744, -22.0052, 2.49282, -21.8049, 10.4903, -21.8262, 18.4903, -22.0492, 26.4872, -22.2944, 34.4834, -22.3504, 42.4832, -22.2709, 50.4828, -22.505, 58.4794, -23.6629, 66.3952, -26.0797, 74.0214, -29.5192, 81.2442, -33.2904, 88.2996, -36.5593, 95.6013, -38.5694, 103.345, -38.8288, 111.34, -37.4621, 119.223, -36.4116, 127.154, -41.3294, 133.463)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_003cn")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, -2)
segments = 20
segment_length = 8
min_angle = 0
inertia = 0.6
dampening = 0.8
transfer = 0.6
natural_direction = 180.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D5" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
position = Vector2(-166, 208)
points = PackedVector2Array(136, -209, 143.918, -210.14, 142.919, -202.202, 141.728, -194.292, 140.318, -186.417, 138.71, -178.58, 137.08, -170.748, 135.635, -162.879, 134.325, -154.988, 132.705, -147.153, 130.19, -139.559, 126.486, -132.468, 121.844, -125.952, 116.906, -119.659, 112.419, -113.035, 109.095, -105.758, 107.426, -97.9344, 107.386, -89.9345, 108.335, -81.991, 109.318, -74.0516, 109.451, -66.0527, 108.254, -58.1427, 105.907, -50.4948, 103.166, -42.9789, 100.95, -35.2919, 100, -27.3485, 100.335, -19.3555, 100.657, -11.362, 103.634, -3.93646, 96.652, -0.0309711)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_i4mmp")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
segments = 30
segment_length = 8
min_angle = 0
inertia = 0.6
dampening = 0.8
transfer = 0.6
natural_direction = 190.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D6" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, 1, -23.7123, -3.94624, -20.6087, 3.42719, -17.6852, 10.8739, -14.969, 18.3987, -12.4434, 25.9895, -9.93899, 33.5874, -7.25551, 41.1239, -4.44477, 48.6139, -1.92983, 56.2083, -0.310526, 64.0427, 0.0268487, 72.0356, -0.73535, 79.9992, -1.86527, 87.919, -2.43955, 95.8984, -1.67938, 103.862, 0.787342, 111.472, 4.7518, 118.421, 9.54496, 124.826, 14.3706, 131.207, 18.4868, 138.067, 21.3216, 145.548, 23.3371, 153.289, 24.2672, 161.235, 16.3456, 160.118)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_n7wf8")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, 2)
segments = 25
segment_length = 8
min_angle = 0
inertia = 0.6
dampening = 0.8
transfer = 0.6
natural_direction = 160.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0
