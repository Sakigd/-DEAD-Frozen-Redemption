[gd_scene load_steps=14 format=3 uid="uid://bbyfcgyong2sp"]

[ext_resource type="Shader" path="res://ColorQuantizer.gdshader" id="1_fc7if"]
[ext_resource type="Texture2D" uid="uid://cvetkbwfhy8jq" path="res://Igris.png" id="1_t1m4f"]
[ext_resource type="Texture2D" uid="uid://mb07lvlabq0u" path="res://QuantizerDefaultNoise.tres" id="2_kt3v7"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_pc60t"]
shader = ExtResource("1_fc7if")
shader_parameter/opacity = 0.6
shader_parameter/tint_brightness = 1.3
shader_parameter/base_brightness = 0.9
shader_parameter/specular_color = Vector4(0.4, 0.7, 0.9, 1.2)
shader_parameter/specular_contrast = 5.0
shader_parameter/specular_spread = 1.0
shader_parameter/specular_map = ExtResource("2_kt3v7")

[sub_resource type="GDScript" id="GDScript_b57h3"]
script/source = "extends Camera2D
const speed = 300

func _process(delta):
	var move = Vector2.ZERO 
	if Input.is_key_label_pressed(KEY_LEFT) :
		move.x -= speed*delta
	if Input.is_key_label_pressed(KEY_RIGHT) :
		move.x += speed*delta
	if Input.is_key_label_pressed(KEY_UP) :
		move.y -= speed*delta
	if Input.is_key_label_pressed(KEY_DOWN) :
		move.y += speed*delta
	position += move
	if not Input.is_key_label_pressed(KEY_SPACE) :
		get_node(\"../Marker2D\").global_position = get_global_mouse_position()
	
	if Input.is_key_label_pressed(KEY_ESCAPE) :
		get_tree().root.queue_free()
"

[sub_resource type="Curve" id="Curve_yvh1l"]
_data = [Vector2(0.373626, 1), 0.0, 0.0, 0, 0]
point_count = 1

[sub_resource type="CurveXYZTexture" id="CurveXYZTexture_bn682"]
width = 1365
curve_x = SubResource("Curve_yvh1l")
curve_y = SubResource("Curve_yvh1l")
curve_z = SubResource("Curve_yvh1l")

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_j4eab"]
blend_mode = 3

[sub_resource type="Curve" id="Curve_k0b5e"]
_data = [Vector2(0, 0.78022), 3.18302, 1.31868, 0, 0, Vector2(0.836842, 0.736264), -1.78087, -1.78087, 0, 0, Vector2(0.9875, 0.021978), -3.43656, 0.0, 0, 0]
point_count = 3

[sub_resource type="Gradient" id="Gradient_003cn"]
offsets = PackedFloat32Array(0.035, 0.99)
colors = PackedColorArray(0.09, 0.0126, 0.0126, 1, 0.61971, 0.91, 0.3822, 1)

[sub_resource type="GDScript" id="GDScript_x81ac"]
script/source = "@tool
extends Line2D
@export_category(\"Position\")
@export var target : Node2D
@export var offset : Vector2
@export_category(\"Setup\")
@export var segments = 7
@export var segment_length = 16
@export var min_angle = 90
@export_category(\"Physics\")
@export var inertia = 0.5
@export var dampening = 0.5
@export var transfer = 0.75
@export_category(\"Oscillation\")
@export var natural_direction = 0.0
@export var resistance = 1.0
@export_range(-1,1) var oscillation_strength = 0.5
@export var oscillation_speed = 4.0
var velocities = []
@export var record_position = true

func _ready():
	velocities = []
	for x in range(segments) : 
		velocities.append(Vector2.ZERO)

var time = 0.0
func _process(delta):
	if record_position == false and Engine.is_editor_hint() :
		return
	
	time += delta * oscillation_speed
	
	if not points.size() == segments :
		points = []
		velocities = []
		for x in range(segments) : 
			add_point(Vector2.ZERO)
			velocities.append(Vector2.ZERO)
	
	for point in range(points.size()) :
		if point == 0 :
			set_point_position(0,to_local(target.global_position+offset))
			continue
		
		var verylast = null
		if point >= 2 :
			verylast = points[point-2]
		var last = points[point-1]
		var current = points[point]
		var angle = null
		
		#velocities[point] += Vector2.from_angle(last.direction_to(current).angle()-deg_to_rad(90))*sin(point/2)*sin(wind/10)*0.1
		if point != points.size()-1 :
			current += velocities[point]*inertia#*(1-(point+1)/points.size())
			current += velocities[point+1]*inertia*0.5
		
		if last.distance_to(current) != segment_length :
			
			var newpos : Vector2
			if current != last :
				newpos = last.direction_to(current) * segment_length
				velocities[point] += (current.direction_to(last+newpos) * current.distance_to(last+newpos)) * (((point+1)/points.size())*transfer+1-transfer)
			else :
				newpos = Vector2(1,0).normalized() * segment_length
			
			current = last+newpos
			
			if verylast :
				var LV = verylast - last
				var LC = current - last
				angle = rad_to_deg(acos(  (LV.dot(LC)) / (LV.length() * LC.length())  ))
			 
			if angle and angle < min_angle :
				print(\"close at point \",point)
		
		if last :
			velocities[point] = velocities[point].normalized() * velocities[point].length()*dampening
		var natural_direction_vec = Vector2.from_angle(deg_to_rad(natural_direction-90))
		if point == 1 :
			velocities[point] += Vector2.from_angle(natural_direction_vec.angle()+sin(time)*deg_to_rad(oscillation_strength*180)) * natural_direction_vec.length()
		velocities[point] += natural_direction_vec.normalized() * resistance
		
		set_point_position(point,current)
"

[sub_resource type="Gradient" id="Gradient_i4mmp"]
offsets = PackedFloat32Array(0.035, 0.99)
colors = PackedColorArray(0.0126, 0.05517, 0.09, 1, 0.479733, 0.56, 0.0784, 1)

[sub_resource type="Gradient" id="Gradient_n7wf8"]
offsets = PackedFloat32Array(0.035, 0.99)
colors = PackedColorArray(0.0126, 0.09, 0.03066, 1, 0.13395, 0.45, 0.063, 1)

[node name="Scene" type="Node2D"]

[node name="Igris" type="Sprite2D" parent="."]
texture_filter = 1
material = SubResource("ShaderMaterial_pc60t")
position = Vector2(-536, -295)
texture = ExtResource("1_t1m4f")

[node name="Camera" type="Camera2D" parent="."]
script = SubResource("GDScript_b57h3")

[node name="Marker2D" type="Marker2D" parent="."]
position = Vector2(-30, -1)

[node name="Sprite2D" type="Sprite2D" parent="Marker2D"]
position = Vector2(12, 0)
scale = Vector2(0.5, 682.5)
texture = SubResource("CurveXYZTexture_bn682")

[node name="Line2D2" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, -3, -27.5183, -10.6053, -27.5566, -2.60543, -27.0483, 5.37841, -26.3844, 13.3508, -25.601, 21.3124, -24.8471, 29.2768, -24.6489, 37.2743, -25.7705, 45.1953, -28.7583, 52.6164, -33.4504, 59.0959, -39.0568, 64.8028, -44.6846, 70.4886, -49.4817, 76.8908, -52.5675, 84.2717, -53.2734, 92.2405, -51.6678, 100.078, -48.6308, 107.479, -45.3095, 114.757, -42.8013, 122.353, -42.1752, 130.329, -44.32, 138.036, -49.3461, 144.26, -56.2495, 148.303, -63.8528, 150.79, -71.5567, 152.947, -79.0097, 155.854, -85.6609, 160.3, -90.5146, 166.659, -92.1558, 174.489, -89.6005, 182.07, -83.7757, 187.554, -76.5969, 191.084, -69.1244, 193.941, -61.8145, 197.192, -55.089, 201.524, -49.5729, 207.318, -46.1882, 214.567, -46.0719, 222.566, -49.9194, 229.58, -56.7875, 233.682, -64.7095, 234.797, -72.6917, 234.264, -80.6249, 233.232, -88.5815, 232.4, -96.5783, 232.174, -104.554, 232.794, -111.978, 235.776, -119.805, 237.428, -123.811, 244.352)
width = 16.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_003cn")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, -2)
segments = 50
segment_length = 8
min_angle = 0
inertia = 0.35
dampening = 0.9
natural_direction = 190.0
resistance = 0.4
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D3" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
position = Vector2(-172, 204)
points = PackedVector2Array(142, -205, 142.216, -212.997, 142.225, -204.997, 143.278, -197.067, 144.88, -189.229, 146.377, -181.37, 147.363, -173.431, 148.095, -165.465, 149.481, -157.586, 152.404, -150.139, 156.888, -143.514, 162.023, -137.379, 166.579, -130.803, 169.123, -123.218, 168.011, -115.296, 162.645, -109.362, 155.121, -106.644, 147.286, -105.028, 139.789, -102.236, 133.697, -97.051, 130.209, -89.8515, 128.542, -82.0272, 126.502, -74.2915, 122.763, -67.2192, 117.489, -61.204, 111.556, -55.8374, 105.73, -50.3549, 100.635, -44.1875, 96.9097, -37.1076, 95.2675, -29.2779, 96.4156, -21.3607, 100.736, -14.6274, 107.674, -10.6458, 115.656, -10.1089, 123.375, -12.2136, 130.554, -15.7427, 137.408, -19.8688, 144.179, -24.1294, 151.032, -28.2564, 158.063, -32.0728, 165.319, -35.4417, 172.814, -38.2393, 180.532, -40.3448, 188.431, -41.6141, 196.425, -41.9243, 204.369, -40.98, 211.949, -38.4228, 219.047, -34.7319, 226.411, -31.605, 229.002, -24.0365)
width = 16.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_i4mmp")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
segments = 50
segment_length = 8
min_angle = 0
inertia = 0.55
dampening = 0.9
natural_direction = 180.0
resistance = 0.4
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, 1, -30.8934, -6.94996, -28.8784, 0.792121, -26.0764, 8.28539, -23.107, 15.7139, -20.171, 23.1557, -17.0063, 30.5031, -13.2597, 37.5715, -8.993, 44.3387, -4.82319, 51.1661, -1.73774, 58.5471, -0.845731, 66.4973, -2.77846, 74.2603, -7.00115, 81.0551, -12.3146, 87.0356, -17.7617, 92.8947, -22.7203, 99.1727, -26.7259, 106.098, -29.3525, 113.654, -30.1393, 121.615, -28.6236, 129.47, -24.5781, 136.372, -18.3652, 141.412, -10.8937, 144.272, -2.983, 145.463, 5.00841, 145.834, 13.0033, 146.121, 20.9683, 146.868, 28.8064, 148.469, 36.32, 151.216, 43.1928, 155.31, 48.9706, 160.844, 53.0432, 167.73, 54.6634, 175.564, 53.1201, 183.413, 48.2526, 189.762, 41.0404, 193.224, 33.056, 193.722, 25.1936, 192.244, 17.588, 189.764, 10.1206, 186.893, 2.66845, 183.984, -4.84565, 181.238, -12.4582, 178.779, -20.1875, 176.715, -27.9886, 174.943, -35.916, 173.867, -43.8842, 174.579, -47.141, 167.272, -54.94, 169.053)
width = 16.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_n7wf8")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, 2)
segments = 50
segment_length = 8
min_angle = 0
inertia = 0.45
dampening = 0.9
natural_direction = 170.0
resistance = 0.4
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D7" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, -3, -23.8819, -8.15451, -24.2767, -0.164252, -24.7926, 7.81909, -25.484, 15.7892, -26.301, 23.7473, -27.1405, 31.7032, -27.9239, 39.6647, -28.6895, 47.628, -29.6377, 55.5716, -31.0786, 63.4408, -33.2898, 71.1291, -36.3594, 78.5168, -40.1205, 85.5775, -44.2252, 92.4442, -48.2751, 99.3434, -51.9157, 106.467, -54.8905, 113.893, -57.0678, 121.591, -58.4349, 129.474, -59.0677, 137.449, -59.1111, 145.448, -58.7831, 153.442, -58.3864, 161.432, -58.3018, 169.431, -58.948, 177.405, -60.6988, 185.211, -63.7624, 192.602, -68.0788, 199.337, -73.3362, 205.367, -79.1073, 210.907, -84.9654, 216.356, -90.492, 222.14, -95.2243, 228.59, -98.6301, 235.829, -100.177, 243.678, -99.4538, 251.645, -96.9468, 259.242, -93.2047, 266.313, -85.4091, 268.11)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_003cn")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, -2)
segments = 40
segment_length = 8
min_angle = 0
inertia = 0.3
dampening = 0.9
natural_direction = 190.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D8" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
position = Vector2(-172, 204)
points = PackedVector2Array(142, -205, 143.979, -212.751, 144.677, -204.782, 145.715, -196.849, 146.854, -188.931, 147.999, -181.013, 149.098, -173.089, 150.015, -165.142, 150.505, -157.157, 150.358, -149.158, 149.657, -141.189, 148.917, -133.223, 148.949, -125.223, 150.505, -117.376, 153.815, -110.093, 158.38, -103.523, 163.35, -97.2542, 167.86, -90.6465, 170.984, -83.2817, 171.647, -75.3092, 168.918, -67.789, 162.972, -62.4377, 155.382, -59.908, 147.421, -59.1198, 139.431, -58.7153, 131.495, -57.7049, 123.847, -55.3591, 117.071, -51.1069, 112.334, -44.6597, 111.543, -36.699, 115.919, -30.002, 123.188, -26.6603, 131.015, -25.007, 138.821, -23.2549, 146.292, -20.3963, 152.925, -15.9235, 157.516, -9.37158, 158.662, -1.45408, 158.172, 6.5309, 150.172, 6.51019)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_i4mmp")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
segments = 40
segment_length = 8
min_angle = 0
dampening = 0.9
natural_direction = 180.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D9" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, 1, -28.0229, -6.75186, -25.6703, 0.89439, -23.1998, 8.50338, -20.8016, 16.1354, -18.5859, 23.8225, -16.6177, 31.5766, -14.8733, 39.3841, -13.1772, 47.2022, -11.2257, 54.9606, -8.74494, 62.5662, -5.7047, 69.966, -2.42521, 77.2629, 0.486469, 84.7142, 2.27321, 92.5122, 2.24834, 100.512, 0.200305, 108.246, -3.34687, 115.416, -7.45348, 122.282, -11.173, 129.364, -13.6654, 136.966, -14.3822, 144.934, -13.4374, 152.878, -11.6161, 160.668, -9.86045, 168.473, -8.7757, 176.399, -8.33794, 184.387, -7.91441, 192.376, -6.59063, 200.266, -3.56135, 207.67, 1.45511, 213.902, 8.00908, 218.489, 15.3429, 221.685, 22.9266, 224.232, 30.4641, 226.913, 37.6936, 230.339, 44.3009, 234.849, 48.402, 241.718, 55.1118, 246.074, 49.003, 251.24)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_n7wf8")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, 2)
segments = 40
segment_length = 8
min_angle = 0
inertia = 0.4
dampening = 0.9
natural_direction = 170.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D4" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, -3, -27.6087, -10.6343, -26.7743, -2.67789, -25.6026, 5.23583, -24.4164, 13.1474, -23.3477, 21.0757, -22.485, 29.0291, -21.9474, 37.011, -21.7879, 45.0094, -21.833, 53.0092, -21.6939, 61.008, -21.0352, 68.9809, -19.9077, 76.901, -18.85, 84.8308, -18.6658, 92.8287, -20.049, 100.708, -23.1733, 108.073, -27.6382, 114.711, -31.7148, 121.594, -38.0648, 126.46)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_003cn")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, -2)
segments = 20
segment_length = 8
min_angle = 0
inertia = 0.6
dampening = 0.8
transfer = 0.6
natural_direction = 180.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D5" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
position = Vector2(-166, 208)
points = PackedVector2Array(136, -209, 139.681, -216.103, 139.121, -208.123, 138.9, -200.126, 138.695, -192.128, 138.371, -184.135, 137.839, -176.153, 136.982, -168.199, 135.751, -160.294, 134.317, -152.423, 133.065, -144.522, 132.329, -136.556, 132.064, -128.56, 131.729, -120.567, 130.52, -112.659, 127.792, -105.139, 123.444, -98.4232, 117.988, -92.5731, 112.204, -87.0457, 106.896, -81.0604, 102.896, -74.1323, 100.911, -66.3824, 101.017, -58.3831, 102.372, -50.4986, 103.697, -42.6091, 103.804, -34.6098, 102.392, -26.7356, 99.5101, -19.2725, 96.2687, -11.9587, 96.3891, -3.95956)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_i4mmp")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
segments = 30
segment_length = 8
min_angle = 0
inertia = 0.6
dampening = 0.8
transfer = 0.6
natural_direction = 190.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0

[node name="Line2D6" type="Line2D" parent="." node_paths=PackedStringArray("target")]
material = SubResource("CanvasItemMaterial_j4eab")
points = PackedVector2Array(-30, 1, -30.364, -6.99171, -26.8587, 0.199427, -23.051, 7.23515, -19.2304, 14.2639, -15.5145, 21.3485, -11.9836, 28.5272, -8.74845, 35.8438, -5.86299, 43.3054, -3.16922, 50.8382, -0.302797, 58.307, 3.04304, 65.5738, 6.81155, 72.6306, 10.5175, 79.7204, 13.4245, 87.1736, 14.8226, 95.0505, 14.4149, 103.04, 12.6145, 110.835, 10.37, 118.514, 8.76388, 126.351, 8.75768, 134.351, 10.9824, 142.035, 14.8633, 149.031, 19.2117, 155.746, 19.8567, 163.72)
width = 32.0
width_curve = SubResource("Curve_k0b5e")
default_color = Color(0, 0.0627451, 0, 1)
gradient = SubResource("Gradient_n7wf8")
joint_mode = 2
begin_cap_mode = 2
script = SubResource("GDScript_x81ac")
target = NodePath("../Marker2D")
offset = Vector2(0, 2)
segments = 25
segment_length = 8
min_angle = 0
inertia = 0.6
dampening = 0.8
transfer = 0.6
natural_direction = 160.0
resistance = 0.6
oscillation_strength = 0.995
oscillation_speed = 2.0
